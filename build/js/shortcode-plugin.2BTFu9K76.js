window.tinymce.PluginManager.add("shortcode_manager",(function(e,t){const o=PRHelper.getForm(),n=PRHelper.getHTML(),r=PRHelper.getHook();let c=null;e.contentStyles.push("\n            .pr-shortcode-tag {\n                color: #0d6efd;\n                direction: ltr;\n                display: block;\n                text-align: start;\n                unicode-bidi: embed;\n            }\n        "),e.on("BeforeSetContent",(e=>{e.content&&(e.content=e.content.replace(/\[([a-zA-Z0-9_]+)(.*?)\]/g,(function(e,t,o){return`<span class="pr-shortcode-tag" data-shortcode="${t}">[${t}${o}]</span>`})))})),e.on("GetContent",(e=>{e.content&&(e.content=function(e){if(!e)return e;if("undefined"==typeof document||!document.implementation||!document.implementation.createHTMLDocument)return e.replace(/<span\b[^>]*\bclass=(?:"|')?[^"'>]*\bpr-shortcode-tag\b[^"'>]*(?:"|')?[^>]*>([\s\S]*?)<\/span>/gi,"$1");const t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body.querySelectorAll("span.pr-shortcode-tag").forEach((e=>{const o=t.createTextNode(e.textContent);e.parentNode.replaceChild(o,e)})),t.body.innerHTML}(e.content))})),e.addButton("shortcodeEdit",{icon:"edit",tooltip:"Edit Shortcode",onclick:()=>{const t=e.selection.getNode();if(n.is(t,".pr-shortcode-tag")){const e=n.getData(t,"shortcode"),i=t.innerHTML,d=n.getElement(`input#${e}`);if(n.isElement(d)){const e=n.getParent(d,".pr-segment"),c=n.getParent(e,".pr-modal-wrapper"),a=n.getAttribute(c,"id"),s=n.getElement(`button[data-target="#${a}"]`);if(n.isElement(s)){const a=n.getAttribute(e,"id"),l=n.getElement(`.pr-tab-link[href="#${a}"]`,c);if(n.isElement(l)){r.simulateClick(s),r.simulateClick(l),window.PRShortcodeManager.setActiveNode(t,c);const e=function(e){const t={};if("string"==typeof e){const o=/([a-zA-Z0-9_-]+)="([^"]*)"/g;let n;for(;null!==(n=o.exec(e));)t[n[1]]=decodeURIComponent(n[2])}return t}(i);PRHelper.getType().each(e,((e,t)=>{const r=o.getFieldContainer(t,d);n.isElement(r)&&PRBackendHelper.getForm().setFieldValue(r,e)}))}}}c.hide()}}}),e.addButton("shortcodeRemove",{icon:"remove",tooltip:"Remove Shortcode",onclick:()=>{const t=e.selection.getNode();n.is(t,".pr-shortcode-tag")&&(e.dom.remove(t),c.hide())}}),e.on("preinit",(()=>{e.wp&&e.wp._createToolbar?c=e.wp._createToolbar(["shortcodeEdit","shortcodeRemove"],!0):console.error("WordPress TinyMCE API (editor.wp._createToolbar) not found.")})),e.on("click",(function(e){const t=e.target;c.hide(t),c&&n.is(t,".pr-shortcode-tag")&&c.show(t)}))}));