/*! For license information please see multistep.OBS1kaEOO.js.LICENSE.txt */
(()=>{const t=PRHelper.getHTML(),e=PRHelper.getType(),i=PRHelper.getHook();window.PR_MULTISTEPS={};class s{constructor(e,s={}){"string"==typeof e?(this.id=e,this.element=t.getElement(`#${this.id}`)):(this.id=t.getAttribute(e,"id"),this.element=e),this.data={},this.options={startStep:s.startStep||t.getData(e,"start-step")||1,clickable:s.clickable||t.hasClass(e,"pr-multistep-clickable"),handleActions:s.handleActions||!0},this.init(),this.build(),i.doAction("multistep_initialized",this),window.PR_MULTISTEPS[this.id]=this}init(){this.steps=t.getElements(".pr-multistep-nav .pr-multistep-step",this.element),this.options.handleActions&&(this.prev=t.getElements('.pr-multistep-step-actions [data-multistep-type="action-prev"]',this.element),this.next=t.getElements('.pr-multistep-step-actions [data-multistep-type="action-next"]',this.element),this.submit=t.getElements('.pr-multistep-step-actions [data-multistep-type="action-submit"]',this.element)),this.evets=[],this.stopped=!1,this.lastStep=0,this.totalStep=this.steps.length,this.currentStep=1,this.options.startStep>1&&this.goto(this.options.startStep),this.update()}build(){let e=this;this.options.handleActions&&(i.on("click",(t=>{t.preventDefault(),e.setNewStep(e.getPrevStep()),!1!==e.trigger("change")&&e.goto(e.getPrevStep())}),this.prev),i.on("click",(t=>{t.preventDefault(),e.setNewStep(e.getNextStep()),!1!==e.trigger("change")&&e.goto(e.getNextStep())}),this.next),i.on("click",(async s=>{if(s.preventDefault(),await e.checkCanGetNextStep()){const s=t.serializeForm(e.element);i.doAction("multistep_submitted",e,s),i.doAction(`multistep_${e.id}_submitted`,e,s)}}),this.submit)),!0===this.options.clickable&&i.on("click",(function(i){i.preventDefault();let s=t.getData(t.getTarget(i,".pr-multistep-step"),"step");s>0&&(e.setNewStep(s),!1!==e.trigger("change")&&e.goto(s))}),".pr-multistep-nav .pr-multistep-step")}async goto(t,e=!1){return this.showMessage(""),!0===this.stopped?(this.stopped=!1,!1):(this.stop(),(t=parseInt(t))===this.currentStep||t>this.totalStep||t<0||t>this.currentStep&&!e&&!await this.checkCanGetNextStep()||t<this.currentStep&&!e&&!await this.checkCanGetPrevStep()?(this.resume(),!1):(this.lastStep=this.currentStep,this.currentStep=t,this.newStep=0,this.update(),this.trigger("changed"),this.resume(),this.scrollToTop(),i.doAction(`multistep_${this.id}_step_changed`,this),!0))}update(){let e=this.currentStep-1,i=this.steps,s=t.getElements(".pr-multistep-contents .pr-multistep-step-content",this.element);if(i&&i.length>0){let n="";this.isFirstStep()?(n="first",this.changeButtonVisibility(this.next,!0),this.changeButtonVisibility(this.prev,!1),this.changeButtonVisibility(this.submit,!1)):this.isLastStep()?(n="last",this.changeButtonVisibility(this.next,!1),this.changeButtonVisibility(this.prev,!0),this.changeButtonVisibility(this.submit,!0)):(n="between",this.changeButtonVisibility(this.next,!0),this.changeButtonVisibility(this.prev,!0),this.changeButtonVisibility(this.submit,!1)),t.setData(this.element,"multistep-state",n);for(let n=0;n<i.length;n++){let p=i[n],h=s[n],r="pending";n===e?r="current":n<e&&(r="done"),t.setData(p,"multistep-state",r),t.setData(h,"multistep-state",r)}}}async checkCanGetNextStep(){return this.checkCanGetStep("next",this.currentStep+1)}async checkCanGetPrevStep(){return!(this.currentStep-1<0)&&this.checkCanGetStep("prev",this.currentStep-1)}async checkCanGetStep(t,e){let s=i.applyFilters(`multistep_can_goto_${t}_step`,!0,this,e);return s=i.applyFilters(`multistep_${this.id}_can_goto_${t}_step`,s,this,e),s&&"boolean"!=typeof s&&"function"==typeof s.then&&(s=await s),!(!s||"string"==typeof s)||(this.showMessage(s),!1)}stop(t=!0){this.stopped=!0,this.changeButtonsActivity(!1,t)}resume(){this.stopped=!1,this.changeButtonsActivity(!0)}hideActions(){const i=t.getElements(".pr-multistep-step-actions",this.getElement());e.each(i,(function(e){t.hide(e)}))}getButtons(){return e.extend(!0,this.prev,this.next,this.submit)}changeButtonVisibility(e,i=!1){i?t.show(e):t.hide(e)}changeButtonsActivity(i=!1,s=!0){e.each(this.getButtons(),(function(e){t.setElementActivity(e,i,s)}))}isLastStep(){return this.currentStep===this.totalStep}isFirstStep(){return 1===this.currentStep}getPrevStep(){let t=this.currentStep-1;return t<1&&(t=1),t}getNextStep(){let t=this.currentStep+1;return this.totalStep<t&&(t=this.totalStep),t}getNewStep(){return this.newStep}setNewStep(t){this.newStep=t}trigger(t){for(let e=0;e<this.evets.length;e++){let i=this.evets[e];if(i.name===t){if(!0!==i.one)return i.handler.class(this);if(!1===i.fired)return this.evets[e].fired=!0,i.handler.class(this)}}}addEvent(t,e,i){return this.evets.push({name:t,handler:e,one:i,fired:!1}),this}getMessageContainer(){return t.getElement(".pr-multistep-message-container",this.element)}showMessage(e="",i="warning"){let s=this.getMessageContainer();if(s)if(e){t.addAttribute(s,"data-type",i);let n={type:i,content:e,replace:!1};void 0!==window.PRBackendHelper?PRBackendHelper.getHTML().alert(s,n):void 0!==window.PRFrontendHelper&&PRFrontendHelper.getHTML().alert(s,n),this.scrollToTop()}else t.empty(s)}setData(t,e){return this.data[t]=e,this}getData(t=null){return null===t?this.data:this.data[t]}getStepName(e){return t.getData(t.getElement(`[data-step="${e}"]`,this.element),"name")}getCurrentStepName(){return this.getStepName(this.currentStep)}getPrevStepName(){return this.getStepName(this.currentStep-1)}getNextStepName(){return this.getStepName(this.currentStep+1)}getElement(){return this.element}scrollToTop(){t.scrollTo(this.element)}}const n={init:(t,e={})=>new s(t,e),get:e=>("string"!=typeof e&&(e=t.getAttribute(e,"id")),PR_MULTISTEPS[e])};!function(){let s=t.getElements(".pr-multistep-wrap");e.each(s,(t=>{n.init(t)})),i.addAction("init_multistep",((t,e={})=>{n.init(t,e)})),i.addAction("destroy_multistep",(e=>{delete PR_MULTISTEPS[t.getAttribute(e,"id")]}))}(),window.PRMultistep=n})();