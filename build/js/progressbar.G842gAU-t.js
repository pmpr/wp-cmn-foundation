/*! For license information please see progressbar.G842gAU-t.js.LICENSE.txt */
(()=>{"use strict";const t=PRHelper.getHTML(),e=PRHelper.getType(),s=PRHelper.getTool();class i{data={};spots={};options={};element=null;current=0;stopped=!0;finished=!1;duration=0;currentSpot=0;constructor(s,i){if(this.element=t.getElement(s),t.isElement(this.element)){t.addClass(this.element,"processing"),this.finished=!1,this.options=PRHelper.getFormat().parseArgs(i,{parts:5,onFail:null,passed:0,element:"",autorun:!1,duration:0,onStart:null,onFinish:null,validator:null,showPercentage:!0,spots:[50,60,70,80,85,90,95],durationCallback:t=>t}),this.spots=this.getOption("spots",0);const s=["size","type","active"];e.each(s,(e=>{const s=this.getOption(e,!1);!1!==s&&t.setData(this.element,e,s)})),this.duration=this.getOption("duration",0),this.start()}}getData(t){return this.data[t]??null}addData(t,e){this.data[t]=e}getOption(t,e=null){return this.options[t]??e}start(){const e=Math.floor(this.getOption("current",0));this.runCallback("onStart"),this.move(0,!0),this.getOption("showPercentage",!1)&&t.addClass(this.element,"show-percentage"),this.isAutorun()&&this.progressSpot(this.getOption("parts",s.randomInterval(3,7))),this.move(e,!0)}getNextSpot(){return this.spots.length>0&&(this.currentSpot=this.spots.splice(0,1)[0],this.currentSpot<this.current&&this.getNextSpot()),this.currentSpot}progressSpot(t=5){let i=[];if(this.getNextSpot()){const n=this.getOption("passed",0);if(n<this.duration){const r=Math.ceil(100*n/this.duration-(100-this.currentSpot));n>0&&this.move(r,!0);const o=this.duration-n,h=this.splitNumber(o,t);this.current<=0&&this.move(s.randomInterval(1,5)),e.each(h,(t=>{i.push({second:t,move:100*t/o*(this.currentSpot-r)/100})}));let a=0;e.each(i,(t=>{a+=parseInt(t.second),this.progressInterval(t.move,a)}))}else this.spots.length>1&&(this.spots=[this.spots[this.spots.length-1]],this.getNextSpot(),this.move(this.currentSpot,!0))}}progressInterval(t,e){setTimeout((async()=>{let e=this.current+Math.ceil(t);e>this.currentSpot&&(e=this.currentSpot),await this.move(e)}),1e3*e)}isAutorun(){return this.getOption("autorun",!1)}finish(){this.move(100)}afterFinishProgress(){this.finished||(t.setData(this.element,"active",""),this.runCallback("onFinish"),t.addClass(this.element,"finished"),this.finished=!0)}fail(){this.finished=!0,this.runCallback("onFail"),t.addClass(this.element,"failed")}stop(){this.stopped=!0}resume(){this.stopped=!1}async move(e,s=!1){e>100&&(e=100),this.progress(e,s),t.setData(this.element,"percentage",e),e>0&&(this.current=e,e<=100&&this.isAutorun()&&await this.checkSpotReached())}progress(e,s){const i=t.getElement(".pr-progress-bar",this.element);if((e=Math.min(100,e))>0&&!s){const t=t=>{let i=parseInt(t.style.width);isNaN(i)&&(i=0),i>=e?clearInterval(s):(i++,t.style.width=`${i}%`,this.showProgress(i),i>=100&&this.afterFinishProgress())},s=setInterval((()=>t(i)),50)}else e=Math.max(0,e),i.style.width=`${e}%`,this.showProgress(e)}showProgress(e){this.getOption("showPercentage",!1)&&t.setHTML(t.getElement(".pr-progress-text",this.element),PRHelper.getI18n().percentage(e))}async checkSpotReached(){if(!this.finished){if(!e.isEmpty(this.spots))return this.currentSpot<=this.current&&await this.maybeFinish(),!1;await this.maybeFinish()}}async maybeFinish(){await this.validation()?this.finish():(this.getNextSpot(),this.progressInterval(this.currentSpot-this.current,this.duration))}splitNumber(t,e){if(e<=1)return[t];const s=Math.abs(t/e-5),i=t-s*e,n=[];for(let t=0;t<e;t++)n.push(Math.random());const r=i/n.reduce(((t,e)=>t+e));return n.map((t=>Math.ceil(t*r+s)))}async validation(){const t=this.getOption("validator");return"function"!=typeof t||await t(this)}runCallback(t,e=[],s=!1){let i=s;const n=this.getOption(t);return"function"==typeof n&&(e.push(this),i=n(...e)),i}}class n{startAll(s={},i=".pr-progress"){const n=t.getElements(i);e.each(n,(t=>{this.start(t,s)}))}start(e,s){if(e=t.getElement(e),t.isElement(e)){let n=t.getData(e,"config");return"object"!=typeof n&&(n={}),new i(e,PRHelper.getFormat().parseArgs(n,s))}return!1}}window.PRProgress=new n})();